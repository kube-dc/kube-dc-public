global:
  security:
    allowInsecureImages: true

extraEnvVars:
  - name: KC_FEATURES
    value: "preview,organization"
  - name: KC_PROXY_HEADERS
    value: "xforwarded"
  - name: KC_HTTP_ENABLED
    value: "true"
  - name: KC_HOSTNAME_STRICT
    value: "false"

image:
  registry: docker.io
  repository: bitnamilegacy/keycloak
  tag: 26.0.7-debian-12-r0

auth:
  adminUser: admin
  adminPassword: HZevBeN7kenw
  existingSecret: ""
  passwordSecretKey: ""

service:
  type: ClusterIP
  http:
    enabled: true

ingress:
  enabled: false
  ingressClassName: nginx
  hostname: login.stage.kube-dc.com
  hostnameStrict: true
  path: /
  pathType: Prefix
  servicePort: http
  annotations:
    kubernetes.io/ingress.class: "nginx"
    cert-manager.io/cluster-issuer: "letsencrypt-prod-http"
  tls: true
  secrets: []

production: true

proxy: edge

tls:
  enabled: false
  autoGenerated: false

logging:
  output: default
  level: INFO

resources:
  requests:
    cpu: 250m
    memory: 512Mi

# Mount Kube-DC custom theme via init container
initContainers:
  - name: theme-provider
    image: busybox:1.36
    imagePullPolicy: IfNotPresent
    command:
      - sh
      - -c
      - |
        echo "Copying Kube-DC theme..."
        mkdir -p /theme/login/resources/css
        mkdir -p /theme/login/resources/img
        mkdir -p /theme/login/messages
        mkdir -p /theme/account/resources/css
        mkdir -p /theme/account/resources
        mkdir -p /theme/common/resources
        cp /theme-files/* /theme/ 2>/dev/null || true
        cp /theme-css/kube-dc.css /theme/login/resources/css/ 2>/dev/null || true
        cp /theme-css/kube-dc-account.css /theme/account/resources/css/ 2>/dev/null || true
        cp /theme-logo/* /theme/login/resources/img/ 2>/dev/null || true
        cp /theme-logo/logo.png /theme/account/resources/ 2>/dev/null || true
        cp /theme-files/common-favicon.png /theme/common/resources/favicon.png 2>/dev/null || true
        cp /theme-files/common-favicon.png /theme/login/resources/img/favicon.png 2>/dev/null || true
        cp /theme-files/kube-dc-white.png /theme/login/resources/img/kube-dc-white.png 2>/dev/null || true
        cp /theme-files/messages_en.properties /theme/login/messages/ 2>/dev/null || true
        cp /theme-files/login-theme.properties /theme/login/theme.properties 2>/dev/null || true
        cp /theme-files/account-theme.properties /theme/account/theme.properties 2>/dev/null || true
        cp /theme-files/login.ftl /theme/login/ 2>/dev/null || true
        cp /theme-files/template.ftl /theme/login/ 2>/dev/null || true
        ls -laR /theme/
        echo "Theme copy complete"
    volumeMounts:
      - name: theme
        mountPath: /theme
      - name: kube-dc-theme-files
        mountPath: /theme-files
      - name: kube-dc-theme-css
        mountPath: /theme-css
      - name: kube-dc-theme-logo
        mountPath: /theme-logo

extraVolumes:
  - name: theme
    emptyDir: {}
  - name: kube-dc-theme-files
    configMap:
      name: kube-dc-theme-files
  - name: kube-dc-theme-css
    configMap:
      name: kube-dc-theme-css
  - name: kube-dc-theme-logo
    configMap:
      name: kube-dc-theme-logo

extraVolumeMounts:
  - name: theme
    mountPath: /opt/bitnami/keycloak/themes/kube-dc

postgresql:
  enabled: true
  image:
    registry: docker.io
    repository: bitnamilegacy/postgresql
    tag: 17.2.0-debian-12-r2
  primary:
    resources:
      requests:
        cpu: 250m
        memory: 256Mi
